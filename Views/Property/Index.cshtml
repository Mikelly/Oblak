@using Oblak.Models;
@using Oblak.Models.Api;

@{
    ViewBag.Title = "Smještajni objekti";
    Layout = "~/Views/Shared/_Layout.cshtml";    
}

<script type="text/javascript">

    $(document).ready(function () {

    });

    function mupObj(event) {
        event.preventDefault();
        event.stopImmediatePropagation();
        event.stopPropagation();

        var grid = $('#PropertiesGrid').data('kendoGrid');

        $.ajax({
            url: '@Url.Content("~/api/properties")',
            type: 'GET',
            success: function (data) {
                grid.dataSource.read();
            }
        });
    }

    function objSelected(e) {
        grid = e.sender;
        var item = grid.dataItem(this.select());
        $('#jedplc').load('/rbjed/rbjed?objekat=' + item.ID);
    }

</script>

<style type="text/css">
</style>

<div style="display: flex; align-items:center; margin-left: 10px;">
    @(Html.Kendo().Button().Name("btnLoadObjects")
            .Content("<img style='width:52px;height:52px;text-align:center; position:relative; top:-1px; left:1px;' src='/Content/Icons/real_estate.png'></img>")
            .HtmlAttributes(new { onclick = "mupObj(event)", style = "width:80px; height:80px; border-radius:50%;" })
            )
    <div style="display:inline-block; margin-left:10px;"><b>Preuzmi prijavljene smještajne<br />objekte iz MUP-a</b></div>
</div>

<div style="position:absolute; top:105px; left:15px; right: 15px; bottom: 500px;">
    @(
        Html.Kendo().Grid<PropertyDto>()
                .Name("PropertiesGrid")
                .Columns(columns =>
                {
                    columns.Bound(p => p.Id).Filterable(false).Width(100);
                    columns.Bound(p => p.Name).Width(200);
                    columns.Bound(p => p.ExternalId).Width(100);
                    columns.Bound(p => p.Address).Width(150);
                    columns.Bound(p => p.AutoCheckOut).Width(150);
                    columns.Bound(p => p.AutoCheckOutTime).Format("{0:HH:mm}").Width(140);
                    columns.Bound(p => p.Municipality).Width(140);
                    columns.Bound(p => p.DefaultEntryPoint).Width(140);
                })
            .Pageable(p => p.Refresh(true))
            .Sortable()
            .Selectable()
            .Scrollable()
            .Filterable()
            .HtmlAttributes(new { style = "height:100%;" })
            .DataSource(ds => ds
                .Ajax()
                .PageSize(20)
                .Read(read => read.Action("Read", "Property"))
                .Model(m =>
                {
                    m.Id(a => a.Id);
                    m.Field(a => a.Id);
                    m.Field(a => a.Name);
                    m.Field(a => a.ExternalId);
                    m.Field(a => a.Address);
                    m.Field(a => a.AutoCheckOut);
                    m.Field(a => a.AutoCheckOutTime);
                    m.Field(a => a.Municipality);
                    m.Field(a => a.DefaultEntryPoint);
                })
            )
        )
</div>

<div id="jedplc" style="position:absolute; top:calc(100% - 480px); left:15px; right: 15px; bottom: 30px;">

</div>

